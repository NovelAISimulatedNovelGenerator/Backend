# NovelAI Proto 文件概述

## 简介

本文档提供了NovelAI项目中Proto文件的总体概述，这些Proto文件定义了系统各服务的接口和数据模型，是基于字节跳动的Hertz框架使用hz工具生成后端代码的基础。

## 系统架构

NovelAI系统采用基于微服务的架构设计，主要包含以下三个核心服务模块：

1. **用户服务** (`user.proto`): 负责用户账户管理
2. **背景服务** (`background.proto`): 负责世界观、规则和背景信息管理
3. **保存服务** (`save.proto`): 负责用户创作内容的存储和管理

## 服务模块关系图

```
+----------------+      +-------------------+      +--------------+
|                |      |                   |      |              |
| UserService    |----->| BackgroundService |<-----| SaveService  |
| (user.proto)   |      | (background.proto)|      | (save.proto) |
|                |      |                   |      |              |
+----------------+      +-------------------+      +--------------+
```

## Proto文件详情

### [user.proto](./user_proto.md)

用户服务定义，包含：
- 用户数据模型
- 用户注册和登录接口
- 用户信息获取和更新接口

### [background.proto](./background_proto.md)

背景服务定义，包含：
- 世界观(Worldview)数据模型和接口
- 规则(Rule)数据模型和接口
- 背景信息(BackgroundInfo)数据模型和接口

### [save.proto](./save_proto.md)

保存服务定义，包含：
- 保存项数据模型
- 创建、获取、更新、删除和列出保存项的接口

## 通用设计模式

所有Proto文件遵循以下通用设计模式：

1. **统一的响应格式**：所有RPC响应都包含`code`和`message`字段
   - `code`: 0表示成功，非0表示失败
   - `message`: 提供额外的响应信息

2. **认证模式**：用户相关操作需要`user_id`和`token`双重认证

3. **分页支持**：列表查询接口支持`page`和`page_size`参数

4. **筛选功能**：列表查询接口支持各种筛选条件，如标签、类型等

5. **时间追踪**：所有核心数据模型包含创建时间和更新时间字段

## 后续开发指南

1. 使用Hertz框架的hz工具基于这些proto文件生成代码框架
2. 实现各服务的业务逻辑
3. 添加数据库交互层
4. 完善错误处理和日志记录（使用Hertz的hlog包）
5. 实现服务间通信机制

## 相关技术栈

- **框架**: 字节跳动Hertz
- **日志**: Hertz hlog
- **协议**: Protocol Buffers (protobuf)
- **代码生成**: hz工具
